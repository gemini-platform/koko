package client

import (
	"encoding/json"
	"testing"

	"github.com/jumpserver/koko/pkg/jms-sdk-go/model"
	"github.com/jumpserver/koko/pkg/jms-sdk-go/service"
)

var (
	host = "https://jumpserver-test4.virtaicloud.com:31443"
	accessKeyID = "32e04022-92db-4e0e-a197-bab2eff430db"
	accessKeySecret =  "223f82fd-dca0-4bf0-ae79-cbb4da42810c"

	userInfo = map[string]interface{}{
		"id": "1754",
		"name": "超管",
		"username": "gemini",
		"email":        "admini@local.com",
		"system_roles":[]string{service.SystemRoleIdUser},
	}

	permInfo = map[string]interface{}{
		"name": "gemini-perm",
		"actions":      []string{model.ActionALL},
		"users":        []string{"33ba346394f24a64b6827c515393245d"},
		"system_users": []string{"079ae82a301340c4a9c17e4a3e720205"},
		"nodes":        []string{"bb79b288a043425aa002ca31ee70e665"},
	}
)

func init() {
	Initial(host, accessKeyID, accessKeySecret, "1", "")
}

func Test_ListAssetNode(t *testing.T) {
	jsonStr := `[{"id":"92a3f93b-6d80-4297-ac9e-a85954c0dce1","key":"1","value":"Default","org_id":"00000000-0000-0000-0000-000000000002","name":"Default","full_value":"/Default","org_name":"Default"},{"id":"52948969-2a29-49c8-bdb1-17060a068b52","key":"1:21","value":"aaaaaa","org_id":"00000000-0000-0000-0000-000000000002","name":"aaaaaa","full_value":"/Default/aaaaaa","org_name":"Default"},{"id":"da56dec6-1041-4d22-8979-7a72e6ac44a5","key":"1:30","value":"automationAdmin","org_id":"00000000-0000-0000-0000-000000000002","name":"automationAdmin","full_value":"/Default/automationAdmin","org_name":"Default"},{"id":"a6bb1088-0b28-4e65-a2a5-584b8419ea1c","key":"1:25","value":"automationTest01","org_id":"00000000-0000-0000-0000-000000000002","name":"automationTest01","full_value":"/Default/automationTest01","org_name":"Default"},{"id":"fdcd9910-547c-469c-a4be-516dce73bd8e","key":"1:26","value":"automationTest02","org_id":"00000000-0000-0000-0000-000000000002","name":"automationTest02","full_value":"/Default/automationTest02","org_name":"Default"},{"id":"ea477859-c064-4287-840d-3b1381033009","key":"1:27","value":"automationTest03","org_id":"00000000-0000-0000-0000-000000000002","name":"automationTest03","full_value":"/Default/automationTest03","org_name":"Default"},{"id":"d103f1b6-1345-4476-9786-34fe8626ed32","key":"1:28","value":"automationTest04","org_id":"00000000-0000-0000-0000-000000000002","name":"automationTest04","full_value":"/Default/automationTest04","org_name":"Default"},{"id":"6b2ee0f2-7ba7-4b1f-a3f8-f9182142ad7c","key":"1:29","value":"automationTest05","org_id":"00000000-0000-0000-0000-000000000002","name":"automationTest05","full_value":"/Default/automationTest05","org_name":"Default"},{"id":"bf77d48b-9852-406d-9224-579019a0256e","key":"1:134","value":"chenyue","org_id":"00000000-0000-0000-0000-000000000002","name":"chenyue","full_value":"/Default/chenyue","org_name":"Default"},{"id":"881cd3bc-04c3-4cc4-b896-597adb4ced42","key":"1:1","value":"cytest","org_id":"00000000-0000-0000-0000-000000000002","name":"cytest","full_value":"/Default/cytest","org_name":"Default"},{"id":"dde43b8a-bb19-420e-92e2-770143c1c76a","key":"1:7","value":"cytest1","org_id":"00000000-0000-0000-0000-000000000002","name":"cytest1","full_value":"/Default/cytest1","org_name":"Default"},{"id":"97a105dc-347d-4503-8d30-a494f9b51423","key":"1:19","value":"daijun","org_id":"00000000-0000-0000-0000-000000000002","name":"daijun","full_value":"/Default/daijun","org_name":"Default"},{"id":"827720b0-a7b0-443f-92d0-ef1ba9cbbe64","key":"1:64","value":"DetailHuaweiDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"DetailHuaweiDatasource_0","full_value":"/Default/DetailHuaweiDatasource_0","org_name":"Default"},{"id":"23d97429-54d0-4d22-b033-90cf63a0e0ef","key":"1:95","value":"difySharedImagePrivate_0","org_id":"00000000-0000-0000-0000-000000000002","name":"difySharedImagePrivate_0","full_value":"/Default/difySharedImagePrivate_0","org_name":"Default"},{"id":"589e3e19-d392-4ba4-9613-5d6fb0bb3a4d","key":"1:76","value":"document","org_id":"00000000-0000-0000-0000-000000000002","name":"document","full_value":"/Default/document","org_name":"Default"},{"id":"60682e1d-60e6-47ee-990c-17df4e37a304","key":"1:41","value":"DownloadCodesetVersion_0","org_id":"00000000-0000-0000-0000-000000000002","name":"DownloadCodesetVersion_0","full_value":"/Default/DownloadCodesetVersion_0","org_name":"Default"},{"id":"be6a6f69-f061-42a5-a352-94c9aa5af8ea","key":"1:130","value":"eeeeee","org_id":"00000000-0000-0000-0000-000000000002","name":"eeeeee","full_value":"/Default/eeeeee","org_name":"Default"},{"id":"1ac89588-9e16-499f-ab14-fe6fffd80d06","key":"1:58","value":"eiDatasourceAccesstype_0","org_id":"00000000-0000-0000-0000-000000000002","name":"eiDatasourceAccesstype_0","full_value":"/Default/eiDatasourceAccesstype_0","org_name":"Default"},{"id":"26966f31-6667-4132-976d-9363e5512b71","key":"1:61","value":"estAddHuaWeiDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"estAddHuaWeiDatasource_0","full_value":"/Default/estAddHuaWeiDatasource_0","org_name":"Default"},{"id":"2c69d8ef-671e-4e16-ba53-c6b144b98141","key":"1:63","value":"estDetailAwsDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"estDetailAwsDatasource_0","full_value":"/Default/estDetailAwsDatasource_0","org_name":"Default"},{"id":"9d860a12-3d50-43e4-aa75-50dc2d0da2fd","key":"1:65","value":"estDetailNfsDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"estDetailNfsDatasource_0","full_value":"/Default/estDetailNfsDatasource_0","org_name":"Default"},{"id":"401c489c-c20a-4bd0-a9be-8f3addee795e","key":"1:32","value":"estFixGitEssentialInfo_0","org_id":"00000000-0000-0000-0000-000000000002","name":"estFixGitEssentialInfo_0","full_value":"/Default/estFixGitEssentialInfo_0","org_name":"Default"},{"id":"bda50f45-5b2b-4199-a981-6b734d4b9641","key":"1:86","value":"estImageRepositoryName_0","org_id":"00000000-0000-0000-0000-000000000002","name":"estImageRepositoryName_0","full_value":"/Default/estImageRepositoryName_0","org_name":"Default"},{"id":"c406853c-3a5c-4e6d-b87b-52e7ae0374e8","key":"1:87","value":"estImageRepositoryName_1","org_id":"00000000-0000-0000-0000-000000000002","name":"estImageRepositoryName_1","full_value":"/Default/estImageRepositoryName_1","org_name":"Default"},{"id":"ac46f23b-057f-4bfb-b716-61bd86774aff","key":"1:88","value":"estMultiSpaceUserImage_0","org_id":"00000000-0000-0000-0000-000000000002","name":"estMultiSpaceUserImage_0","full_value":"/Default/estMultiSpaceUserImage_0","org_name":"Default"},{"id":"f5d3f636-0d15-4adb-8940-acea3109c9d9","key":"1:59","value":"fsDatasourceAccesstype_0","org_id":"00000000-0000-0000-0000-000000000002","name":"fsDatasourceAccesstype_0","full_value":"/Default/fsDatasourceAccesstype_0","org_name":"Default"},{"id":"bb79b288-a043-425a-a002-ca31ee70e665","key":"1:0","value":"gemini","org_id":"00000000-0000-0000-0000-000000000002","name":"gemini","full_value":"/Default/gemini","org_name":"Default"},{"id":"e604e9f5-fb79-452e-864f-53035bd60901","key":"1:2","value":"hmmtest001","org_id":"00000000-0000-0000-0000-000000000002","name":"hmmtest001","full_value":"/Default/hmmtest001","org_name":"Default"},{"id":"d83d28c2-fd68-475f-8930-b26956836956","key":"1:3","value":"hmmtest002","org_id":"00000000-0000-0000-0000-000000000002","name":"hmmtest002","full_value":"/Default/hmmtest002","org_name":"Default"},{"id":"c9a7299f-7854-4e07-8bd5-b1c4aa8efa57","key":"1:126","value":"hmmtest004","org_id":"00000000-0000-0000-0000-000000000002","name":"hmmtest004","full_value":"/Default/hmmtest004","org_name":"Default"},{"id":"cf59d47b-0529-4c72-b725-0c9525eb85ef","key":"1:127","value":"hmmtest005","org_id":"00000000-0000-0000-0000-000000000002","name":"hmmtest005","full_value":"/Default/hmmtest005","org_name":"Default"},{"id":"2ef71c2a-41bc-4d49-8e51-937a10c67c91","key":"1:129","value":"hmmtest008","org_id":"00000000-0000-0000-0000-000000000002","name":"hmmtest008","full_value":"/Default/hmmtest008","org_name":"Default"},{"id":"d33c1658-fb45-4b01-b268-f6cc96de457b","key":"1:128","value":"hmmtest009","org_id":"00000000-0000-0000-0000-000000000002","name":"hmmtest009","full_value":"/Default/hmmtest009","org_name":"Default"},{"id":"10da2b28-8cbb-44c9-b2eb-76d8880d70d5","key":"1:23","value":"jjjjjj","org_id":"00000000-0000-0000-0000-000000000002","name":"jjjjjj","full_value":"/Default/jjjjjj","org_name":"Default"},{"id":"46bb7221-bf6f-4648-9833-859ea4edef40","key":"1:11","value":"kevin1","org_id":"00000000-0000-0000-0000-000000000002","name":"kevin1","full_value":"/Default/kevin1","org_name":"Default"},{"id":"2a8707dc-96df-40b6-8da9-46825b827dd1","key":"1:12","value":"kevin2","org_id":"00000000-0000-0000-0000-000000000002","name":"kevin2","full_value":"/Default/kevin2","org_name":"Default"},{"id":"47ece76d-09cc-4cf2-bcb2-1bed2f75daaf","key":"1:79","value":"kevin3","org_id":"00000000-0000-0000-0000-000000000002","name":"kevin3","full_value":"/Default/kevin3","org_name":"Default"},{"id":"20622395-633e-4b52-bf9f-3eaf387bb62f","key":"1:10","value":"lipeng","org_id":"00000000-0000-0000-0000-000000000002","name":"lipeng","full_value":"/Default/lipeng","org_name":"Default"},{"id":"5b249cc7-0430-4be6-b74b-002ebab1141d","key":"1:42","value":"loadCodesetVersionFile_0","org_id":"00000000-0000-0000-0000-000000000002","name":"loadCodesetVersionFile_0","full_value":"/Default/loadCodesetVersionFile_0","org_name":"Default"},{"id":"6393cf57-9607-4309-a811-64fc3ce5754c","key":"1:97","value":"ModifySharedImageShare_0","org_id":"00000000-0000-0000-0000-000000000002","name":"ModifySharedImageShare_0","full_value":"/Default/ModifySharedImageShare_0","org_name":"Default"},{"id":"6fa433ac-7cd9-4165-b8fd-e68cc96b7a5e","key":"1:96","value":"odifySharedImagePublic_0","org_id":"00000000-0000-0000-0000-000000000002","name":"odifySharedImagePublic_0","full_value":"/Default/odifySharedImagePublic_0","org_name":"Default"},{"id":"eea60ebc-bcec-448b-9355-04f6e09991b5","key":"1:55","value":"perateDatasourceDetail_0","org_id":"00000000-0000-0000-0000-000000000002","name":"perateDatasourceDetail_0","full_value":"/Default/perateDatasourceDetail_0","org_name":"Default"},{"id":"486dfb2e-6f74-45bc-ac7f-0050c9a8a594","key":"1:13","value":"qqqqqq","org_id":"00000000-0000-0000-0000-000000000002","name":"qqqqqq","full_value":"/Default/qqqqqq","org_name":"Default"},{"id":"f3fe061a-a4d3-4bbb-b6d6-f7fe53c46bac","key":"1:40","value":"stCreateCodesetVersion_0","org_id":"00000000-0000-0000-0000-000000000002","name":"stCreateCodesetVersion_0","full_value":"/Default/stCreateCodesetVersion_0","org_name":"Default"},{"id":"bbd80777-b734-4b68-b744-1dea15dd345d","key":"1:56","value":"stManageDatasourceList_0","org_id":"00000000-0000-0000-0000-000000000002","name":"stManageDatasourceList_0","full_value":"/Default/stManageDatasourceList_0","org_name":"Default"},{"id":"eb53d0f3-c714-4f3a-9fd2-2e5a0ca5d16d","key":"1:69","value":"stModifyJoinDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"stModifyJoinDatasource_0","full_value":"/Default/stModifyJoinDatasource_0","org_name":"Default"},{"id":"cf4d6dc0-6f7d-40d4-b2f0-a5fdd25828d0","key":"1:71","value":"stPermissionDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"stPermissionDatasource_0","full_value":"/Default/stPermissionDatasource_0","org_name":"Default"},{"id":"75f32701-dc18-4c29-b240-c989e6362fbb","key":"1:72","value":"stPermissionDatasource_1","org_id":"00000000-0000-0000-0000-000000000002","name":"stPermissionDatasource_1","full_value":"/Default/stPermissionDatasource_1","org_name":"Default"},{"id":"0a3370e0-1f76-4fc5-bb14-48d1b568eae5","key":"1:73","value":"stPermissionDatasource_2","org_id":"00000000-0000-0000-0000-000000000002","name":"stPermissionDatasource_2","full_value":"/Default/stPermissionDatasource_2","org_name":"Default"},{"id":"be6d26bb-45dc-4217-8401-c9c0e862d4f8","key":"1:68","value":"suyuhahaha","org_id":"00000000-0000-0000-0000-000000000002","name":"suyuhahaha","full_value":"/Default/suyuhahaha","org_name":"Default"},{"id":"4ba2608c-c1a1-40a7-8a80-018f042dbb52","key":"1:131","value":"tDistributedJobDetails_0","org_id":"00000000-0000-0000-0000-000000000002","name":"tDistributedJobDetails_0","full_value":"/Default/tDistributedJobDetails_0","org_name":"Default"},{"id":"df2b2958-1b15-4a3b-beae-97f13c4bfec9","key":"1:60","value":"TestAddAwsDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestAddAwsDatasource_0","full_value":"/Default/TestAddAwsDatasource_0","org_name":"Default"},{"id":"540accac-0f3a-4507-823a-f75aa748dff9","key":"1:77","value":"TestAddDistributeJob_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestAddDistributeJob_0","full_value":"/Default/TestAddDistributeJob_0","org_name":"Default"},{"id":"536c738a-458f-44cc-a8cd-586ff881247b","key":"1:78","value":"TestAddDistributeJob_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestAddDistributeJob_1","full_value":"/Default/TestAddDistributeJob_1","org_name":"Default"},{"id":"484c8c8c-a399-4c1a-8843-c2bfd1a9c576","key":"1:62","value":"TestaddNfsDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestaddNfsDatasource_0","full_value":"/Default/TestaddNfsDatasource_0","org_name":"Default"},{"id":"6b688028-07b9-4dce-bf1b-51262afd0d28","key":"1:14","value":"TestAddSingleJob_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestAddSingleJob_0","full_value":"/Default/TestAddSingleJob_0","org_name":"Default"},{"id":"6c51af74-da6c-455c-8a16-933b706269e4","key":"1:15","value":"TestAddSingleJob_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestAddSingleJob_1","full_value":"/Default/TestAddSingleJob_1","org_name":"Default"},{"id":"08103d04-c0c5-4fa3-98ef-b55dc968f3b1","key":"1:24","value":"TestConnectGit_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestConnectGit_0","full_value":"/Default/TestConnectGit_0","org_name":"Default"},{"id":"3e6b4f9a-40fc-46d3-b6f2-bf106b9409c4","key":"1:34","value":"TestCreateCodeset_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestCreateCodeset_0","full_value":"/Default/TestCreateCodeset_0","org_name":"Default"},{"id":"adecb177-0803-40c8-86b1-3211d0e8ba62","key":"1:46","value":"TestCreateDataset_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestCreateDataset_0","full_value":"/Default/TestCreateDataset_0","org_name":"Default"},{"id":"d84be087-e0cd-49ba-b13d-23d2bef2f642","key":"1:47","value":"TestCreateDataset_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestCreateDataset_1","full_value":"/Default/TestCreateDataset_1","org_name":"Default"},{"id":"a3cea085-4812-4542-a3f8-8d0b61788228","key":"1:36","value":"TestCreateDir_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestCreateDir_0","full_value":"/Default/TestCreateDir_0","org_name":"Default"},{"id":"bacf00a7-3630-464a-9f6f-66491fe66a01","key":"1:31","value":"TestCreateGitRepo_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestCreateGitRepo_0","full_value":"/Default/TestCreateGitRepo_0","org_name":"Default"},{"id":"1d6d3a30-00be-4ad1-b3a7-3071711d04e3","key":"1:44","value":"TestDatasetAdminList_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDatasetAdminList_0","full_value":"/Default/TestDatasetAdminList_0","org_name":"Default"},{"id":"a9b97bff-1b15-4b95-bd55-b2db5b22e009","key":"1:45","value":"TestDatasetAdminList_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDatasetAdminList_1","full_value":"/Default/TestDatasetAdminList_1","org_name":"Default"},{"id":"8e4bebe5-6a1e-43ac-8ee7-efb721f51e8f","key":"1:48","value":"TestDatasetList_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDatasetList_0","full_value":"/Default/TestDatasetList_0","org_name":"Default"},{"id":"a581a829-9e90-49b6-b7cb-7006dd300c80","key":"1:49","value":"TestDatasetList_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDatasetList_1","full_value":"/Default/TestDatasetList_1","org_name":"Default"},{"id":"b0d03fc5-7851-46ed-9ffa-93f72dbd6af1","key":"1:50","value":"TestDatasetList_2","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDatasetList_2","full_value":"/Default/TestDatasetList_2","org_name":"Default"},{"id":"0c9ddeef-9825-4021-a5f7-764c4c90809c","key":"1:37","value":"TestDelDirAndFile_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDelDirAndFile_0","full_value":"/Default/TestDelDirAndFile_0","org_name":"Default"},{"id":"c8a24669-296b-4d3b-8571-ba586c3343b5","key":"1:51","value":"TestDeleteDataset_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDeleteDataset_0","full_value":"/Default/TestDeleteDataset_0","org_name":"Default"},{"id":"3bbb2278-1a5b-45ac-b2f1-b9b2eda84436","key":"1:52","value":"TestDeleteDataset_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDeleteDataset_1","full_value":"/Default/TestDeleteDataset_1","org_name":"Default"},{"id":"2b3c580e-63c8-4bd4-8c7d-cdeb898b9b5a","key":"1:89","value":"TestDeleteImageRepo_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestDeleteImageRepo_0","full_value":"/Default/TestDeleteImageRepo_0","org_name":"Default"},{"id":"027ae93d-472d-4564-8108-8718cb475c0e","key":"1:122","value":"TestEventResource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestEventResource_0","full_value":"/Default/TestEventResource_0","org_name":"Default"},{"id":"01fbf96a-3425-4def-beb4-2285d099647e","key":"1:81","value":"TestImageCheckLimit_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestImageCheckLimit_0","full_value":"/Default/TestImageCheckLimit_0","org_name":"Default"},{"id":"1fd8bca1-0945-447b-8148-1f5b96a37830","key":"1:82","value":"TestImageCheckLimit_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestImageCheckLimit_1","full_value":"/Default/TestImageCheckLimit_1","org_name":"Default"},{"id":"ec06d4e4-9c69-41bf-a5c3-340ed85e7afe","key":"1:83","value":"TestImageCheckLimit_2","org_id":"00000000-0000-0000-0000-000000000002","name":"TestImageCheckLimit_2","full_value":"/Default/TestImageCheckLimit_2","org_name":"Default"},{"id":"63a03d12-3576-41be-8b36-a36cd6d6f2a2","key":"1:84","value":"TestImageInList_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestImageInList_0","full_value":"/Default/TestImageInList_0","org_name":"Default"},{"id":"f3028580-9c09-494e-b1cc-bfab606ab91a","key":"1:93","value":"TestImageTagCount_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestImageTagCount_0","full_value":"/Default/TestImageTagCount_0","org_name":"Default"},{"id":"0ad26606-c201-4b43-b3bb-00f54a523b6d","key":"1:94","value":"TestImageTagCount_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestImageTagCount_1","full_value":"/Default/TestImageTagCount_1","org_name":"Default"},{"id":"2abf3496-7fe7-4af1-8659-8624aaa70207","key":"1:18","value":"testjms","org_id":"00000000-0000-0000-0000-000000000002","name":"testjms","full_value":"/Default/testjms","org_name":"Default"},{"id":"0ecc4583-ae9c-41ab-80ea-1d0549c309b8","key":"1:132","value":"TestJobDetail_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestJobDetail_0","full_value":"/Default/TestJobDetail_0","org_name":"Default"},{"id":"9ec9b4cd-74e8-45cc-99c0-4ddde0f3577b","key":"1:133","value":"TestJobDetail_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestJobDetail_1","full_value":"/Default/TestJobDetail_1","org_name":"Default"},{"id":"2b5cbe95-9c2b-4ef5-8422-afdcaf6ace47","key":"1:120","value":"TestJobWithVisual_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestJobWithVisual_0","full_value":"/Default/TestJobWithVisual_0","org_name":"Default"},{"id":"460d9633-e9e6-4bbc-adfc-835fcbede373","key":"1:121","value":"TestJobWithVisual_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestJobWithVisual_1","full_value":"/Default/TestJobWithVisual_1","org_name":"Default"},{"id":"7e4e18f5-b5c2-4fcf-bf20-c90459361588","key":"1:53","value":"TestModifyDataset_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestModifyDataset_0","full_value":"/Default/TestModifyDataset_0","org_name":"Default"},{"id":"73dfb8f5-aecd-40e4-94bb-83d7c5d324f3","key":"1:54","value":"TestModifyDataset_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestModifyDataset_1","full_value":"/Default/TestModifyDataset_1","org_name":"Default"},{"id":"b8f483a2-4854-4966-b3fe-4205e326e317","key":"1:66","value":"TestModifyDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestModifyDatasource_0","full_value":"/Default/TestModifyDatasource_0","org_name":"Default"},{"id":"f90b4d85-a42f-4b65-9e00-f467b759b97b","key":"1:67","value":"TestModifyDatasource_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestModifyDatasource_1","full_value":"/Default/TestModifyDatasource_1","org_name":"Default"},{"id":"1bee80b0-9550-4fad-ae22-1e228d3ebdd1","key":"1:43","value":"TestModifyVersion_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestModifyVersion_0","full_value":"/Default/TestModifyVersion_0","org_name":"Default"},{"id":"4120e74d-de8a-446e-8b1b-ce565a90819c","key":"1:70","value":"TestNameDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestNameDatasource_0","full_value":"/Default/TestNameDatasource_0","org_name":"Default"},{"id":"c0188ca7-dccd-40f0-867b-e7c1e1741a24","key":"1:98","value":"TestOpsTagCount_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestOpsTagCount_0","full_value":"/Default/TestOpsTagCount_0","org_name":"Default"},{"id":"7b7e724f-b44c-476f-838e-a4105d8a6984","key":"1:119","value":"TestOutputSearchList_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestOutputSearchList_0","full_value":"/Default/TestOutputSearchList_0","org_name":"Default"},{"id":"cdd498c2-e8d7-45e1-80e0-791cf39840e5","key":"1:102","value":"TestPullImage_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestPullImage_0","full_value":"/Default/TestPullImage_0","org_name":"Default"},{"id":"7933226d-3450-4dec-835a-ca673be7ef7d","key":"1:103","value":"TestPullImage_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestPullImage_1","full_value":"/Default/TestPullImage_1","org_name":"Default"},{"id":"5bae3af6-a0b9-4a43-984a-cc7784812522","key":"1:90","value":"TestPushImage_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestPushImage_0","full_value":"/Default/TestPushImage_0","org_name":"Default"},{"id":"801e06c1-cc34-4a32-bce5-70d26283bf3b","key":"1:91","value":"TestPushImage_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestPushImage_1","full_value":"/Default/TestPushImage_1","org_name":"Default"},{"id":"3b1897fe-6b4a-4f88-9f27-a987dfa92d84","key":"1:92","value":"TestPushImage_2","org_id":"00000000-0000-0000-0000-000000000002","name":"TestPushImage_2","full_value":"/Default/TestPushImage_2","org_name":"Default"},{"id":"5948721e-063e-4d29-9ae2-644e8f528221","key":"1:104","value":"TestRemoveImageCreator_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestRemoveImageCreator_0","full_value":"/Default/TestRemoveImageCreator_0","org_name":"Default"},{"id":"1663e233-55a3-411e-bd67-d6a47fd82a89","key":"1:105","value":"TestRemoveImageCreator_1","org_id":"00000000-0000-0000-0000-000000000002","name":"TestRemoveImageCreator_1","full_value":"/Default/TestRemoveImageCreator_1","org_name":"Default"},{"id":"462c238b-c922-4a33-bd0f-231b57f4bbcb","key":"1:38","value":"TestRenameDir_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestRenameDir_0","full_value":"/Default/TestRenameDir_0","org_name":"Default"},{"id":"42e2dbbe-beaa-4de2-9341-531b22d505fe","key":"1:39","value":"TestRenameFile_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestRenameFile_0","full_value":"/Default/TestRenameFile_0","org_name":"Default"},{"id":"c2c5a41f-6dce-4a12-a9ae-aba04a2889a8","key":"1:33","value":"TestRenameRepo_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestRenameRepo_0","full_value":"/Default/TestRenameRepo_0","org_name":"Default"},{"id":"3053329b-cce8-430b-bafb-5c14237d1a93","key":"1:74","value":"TestSearchDatasource_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestSearchDatasource_0","full_value":"/Default/TestSearchDatasource_0","org_name":"Default"},{"id":"2939da58-d2a3-4bbe-a76f-286d210ec514","key":"1:100","value":"TestSearchImageOps_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestSearchImageOps_0","full_value":"/Default/TestSearchImageOps_0","org_name":"Default"},{"id":"fb9eafce-27e2-4def-98fe-3d801028f798","key":"1:85","value":"TestSearchImage_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestSearchImage_0","full_value":"/Default/TestSearchImage_0","org_name":"Default"},{"id":"82dd6b02-9e9f-465c-bc54-6156d994471e","key":"1:123","value":"TestSingleJobDetails_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestSingleJobDetails_0","full_value":"/Default/TestSingleJobDetails_0","org_name":"Default"},{"id":"8e95d6c8-6a7c-4f2b-8a58-b410fb4ebc4b","key":"1:101","value":"TestSystemImageCount_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestSystemImageCount_0","full_value":"/Default/TestSystemImageCount_0","org_name":"Default"},{"id":"9601d9d5-ed78-4411-bcc2-c562012ea21b","key":"1:99","value":"TestUpdateTime_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestUpdateTime_0","full_value":"/Default/TestUpdateTime_0","org_name":"Default"},{"id":"ccde537c-204c-48d0-8eb9-6f82d01f779c","key":"1:35","value":"TestUploadFile_0","org_id":"00000000-0000-0000-0000-000000000002","name":"TestUploadFile_0","full_value":"/Default/TestUploadFile_0","org_name":"Default"},{"id":"ee4f2505-348e-4b33-a67a-cc9cd3d879ef","key":"1:106","value":"tRemoveImageRepository_0","org_id":"00000000-0000-0000-0000-000000000002","name":"tRemoveImageRepository_0","full_value":"/Default/tRemoveImageRepository_0","org_name":"Default"},{"id":"b666e61f-e78d-445c-9a39-50b164248844","key":"1:107","value":"tRemoveImageRepository_1","org_id":"00000000-0000-0000-0000-000000000002","name":"tRemoveImageRepository_1","full_value":"/Default/tRemoveImageRepository_1","org_name":"Default"},{"id":"c5f6095b-2b31-4fc4-a4b7-7f3347fb44f5","key":"1:108","value":"tRemoveImageRepository_2","org_id":"00000000-0000-0000-0000-000000000002","name":"tRemoveImageRepository_2","full_value":"/Default/tRemoveImageRepository_2","org_name":"Default"},{"id":"133423f9-50e5-412d-8b29-4210582e07f7","key":"1:109","value":"user401","org_id":"00000000-0000-0000-0000-000000000002","name":"user401","full_value":"/Default/user401","org_name":"Default"},{"id":"dcb299ca-37c5-44a0-aa4b-5cafd760a1af","key":"1:110","value":"user402","org_id":"00000000-0000-0000-0000-000000000002","name":"user402","full_value":"/Default/user402","org_name":"Default"},{"id":"7151d34e-ce4d-46a7-938d-d42263b94da7","key":"1:111","value":"user403","org_id":"00000000-0000-0000-0000-000000000002","name":"user403","full_value":"/Default/user403","org_name":"Default"},{"id":"68f3ff8f-5494-4029-89f3-e28196edcd78","key":"1:112","value":"user404","org_id":"00000000-0000-0000-0000-000000000002","name":"user404","full_value":"/Default/user404","org_name":"Default"},{"id":"79f43d2c-bf5d-45de-9778-23e67f365ae6","key":"1:113","value":"user405","org_id":"00000000-0000-0000-0000-000000000002","name":"user405","full_value":"/Default/user405","org_name":"Default"},{"id":"facf300b-5796-411d-8718-0fbe9c0ad063","key":"1:114","value":"user406","org_id":"00000000-0000-0000-0000-000000000002","name":"user406","full_value":"/Default/user406","org_name":"Default"},{"id":"cce0a7ed-e907-45ff-afbd-1e03363045f7","key":"1:115","value":"user407","org_id":"00000000-0000-0000-0000-000000000002","name":"user407","full_value":"/Default/user407","org_name":"Default"},{"id":"e20945dd-98da-4682-ad96-c0cff66ff2cf","key":"1:116","value":"user408","org_id":"00000000-0000-0000-0000-000000000002","name":"user408","full_value":"/Default/user408","org_name":"Default"},{"id":"376628d6-ebdc-4e02-b976-babc23966c66","key":"1:117","value":"user409","org_id":"00000000-0000-0000-0000-000000000002","name":"user409","full_value":"/Default/user409","org_name":"Default"},{"id":"02a0a051-d65b-4315-8363-153227261eb9","key":"1:118","value":"user410","org_id":"00000000-0000-0000-0000-000000000002","name":"user410","full_value":"/Default/user410","org_name":"Default"},{"id":"762f4c58-a6d6-42c9-b164-3a676e487e9b","key":"1:57","value":"wsDatasourceAccesstype_0","org_id":"00000000-0000-0000-0000-000000000002","name":"wsDatasourceAccesstype_0","full_value":"/Default/wsDatasourceAccesstype_0","org_name":"Default"},{"id":"e0cad99d-dd0f-4c91-9bc4-6712ea7fe077","key":"1:20","value":"wwwwww","org_id":"00000000-0000-0000-0000-000000000002","name":"wwwwww","full_value":"/Default/wwwwww","org_name":"Default"},{"id":"1d1e6dd0-88b5-44a2-9e9e-6efa5765eac4","key":"1:4","value":"xuhanzhong","org_id":"00000000-0000-0000-0000-000000000002","name":"xuhanzhong","full_value":"/Default/xuhanzhong","org_name":"Default"},{"id":"8e0e8dfc-4aac-40ea-a356-b8cf68379811","key":"1:6","value":"ytian1","org_id":"00000000-0000-0000-0000-000000000002","name":"ytian1","full_value":"/Default/ytian1","org_name":"Default"},{"id":"766a30be-20f1-4e45-9732-7eccab5a0eb7","key":"1:8","value":"ytian2","org_id":"00000000-0000-0000-0000-000000000002","name":"ytian2","full_value":"/Default/ytian2","org_name":"Default"},{"id":"a7e15ae6-445e-4338-8849-a5fba0f8340a","key":"1:22","value":"yyyyyy","org_id":"00000000-0000-0000-0000-000000000002","name":"yyyyyy","full_value":"/Default/yyyyyy","org_name":"Default"},{"id":"6bd37b1d-a4c5-406c-93a9-955482660abc","key":"1:9","value":"zhang1","org_id":"00000000-0000-0000-0000-000000000002","name":"zhang1","full_value":"/Default/zhang1","org_name":"Default"},{"id":"cd8e7d66-0301-4973-800a-626155dda83b","key":"1:5","value":"zhangshuang","org_id":"00000000-0000-0000-0000-000000000002","name":"zhangshuang","full_value":"/Default/zhangshuang","org_name":"Default"},{"id":"434c2aad-889d-469b-a621-8704b6a74303","key":"1:125","value":"zhongsuyu","org_id":"00000000-0000-0000-0000-000000000002","name":"zhongsuyu","full_value":"/Default/zhongsuyu","org_name":"Default"},{"id":"fa1d692a-4725-4e37-8e50-3685c916bec5","key":"1:16","value":"zouzouozu","org_id":"00000000-0000-0000-0000-000000000002","name":"zouzouozu","full_value":"/Default/zouzouozu","org_name":"Default"},{"id":"e1ce865d-f340-4e6b-b126-f87c063bec04","key":"1:17","value":"zouzouozu1","org_id":"00000000-0000-0000-0000-000000000002","name":"zouzouozu1","full_value":"/Default/zouzouozu1","org_name":"Default"}]`


	var nodeList []model.Node

	err := json.Unmarshal([]byte(jsonStr), &nodeList)
	if err != nil {
		t.Fatal(err)
	}

	for _, node := range nodeList {
		t.Log("value", node.Value, "full_value", node.FullValue)
		if node.Value == "Default" && node.FullValue == "/Default" {
			t.Log("root node found, node:", node)
			return
		}
	}


	t.Fatal("root node not found")
}

func Test_UnmarshalSystemUser(t *testing.T) {
	str := `{"id":"0507cef5-9b2d-4913-a520-d6599b31d76d","name":"1754","username":"root","ssh_key_fingerprint":"MD5:64:a4:1c:87:16:7a:a9:85:c4:08:b8:9d:95:80:ae:c2","type":"common","type_display":"普通用户","protocol":"ssh","is_asset_protocol":true,"login_mode":"auto","login_mode_display":"托管密码","priority":81,"sudo":"/bin/whoami","shell":"/bin/bash","sftp_root":"tmp","home":"","system_groups":"","ad_domain":"","username_same_with_user":false,"auto_push":true,"su_enabled":false,"su_from":null,"date_created":"2022/10/25 18:32:34 +0800","date_updated":"2022/10/25 18:32:34 +0800","comment":"","created_by":"Administrator","cmd_filters":[],"assets_amount":0,"applications_amount":0,"nodes":[],"org_id":"00000000-0000-0000-0000-000000000002","org_name":"Default"}`

	var systemUser *model.SystemUser
	err := json.Unmarshal([]byte(str), &systemUser)
	if err != nil {
		t.Fatal(err)
	}
}

func Test_GetUserByUserName(t *testing.T) {
	_, err := svc.GetUserByUserName(userInfo["username"].(string))
	if err != nil {
		t.Fatal(err)
	}
}

func Test_GetOrCreateUser(t *testing.T) {
	_, err := svc.GetOrCreateUser(userInfo)
	if err != nil {
		t.Fatal(err)
	}
}

func Test_GetOrCreateAssetSystemUser(t *testing.T) {
	_, err := svc.GetOrCreateAssetSystemUser(userInfo["id"].(string))
	if err != nil {
		t.Fatal(err)
	}
}

func Test_GetOrCreateAssetNode(t *testing.T) {
	_, err := svc.GetOrCreateAssetSystemUser(userInfo["id"].(string))
	if err != nil {
		t.Fatal(err)
	}
}

func Test_GetOrCreateAssetPermission(t *testing.T) {
	_, err := svc.GetOrCreateAssetPermission(permInfo)
	if err != nil {
		t.Fatal(err)
	}
}
